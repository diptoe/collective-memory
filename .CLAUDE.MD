# Collective Memory Platform

**Project:** Collective Memory
**Company:** Diptoe
**Owner:** Wayne Houlden (wayne@diptoe.com)
**Repository:** https://github.com/diptoe/collective-memory

## Overview

A persistent knowledge graph platform enabling multi-agent AI collaboration with:
- Flask API + SQLAlchemy backend
- PostgreSQL database (AlloyDB Omni in Docker)
- React frontend (Next.js) for human interaction, admin, and debugging
- MCP server integration (deferred to Phase 2)

## Tech Stack

### Backend
- **Framework:** Flask with Flask-RESTX (Swagger/OpenAPI)
- **ORM:** SQLAlchemy
- **Database:** PostgreSQL (AlloyDB Omni)
- **Pattern:** Following Jai API conventions

### Frontend
- **Framework:** Next.js 15 (App Router)
- **Styling:** Tailwind CSS v4
- **State:** Zustand
- **Pattern:** Following Jai React conventions

## Project Structure

```
collective-memory/
├── api/
│   ├── __init__.py          # Flask app factory
│   ├── config.py             # Environment configuration
│   ├── migrations.py         # Auto-discovery migrations
│   ├── models/
│   │   ├── base.py           # BaseModel with CRUD
│   │   ├── entity.py         # Knowledge graph entities
│   │   ├── relationship.py   # Entity relationships
│   │   ├── message.py        # Inter-agent messages
│   │   ├── agent.py          # Agent registration
│   │   ├── persona.py        # AI personas
│   │   ├── conversation.py   # Chat conversations
│   │   └── chat_message.py   # Chat messages
│   ├── routes/
│   │   ├── entities.py       # Entity CRUD
│   │   ├── relationships.py  # Relationship CRUD
│   │   ├── messages.py       # Inter-agent messaging
│   │   ├── agents.py         # Agent management
│   │   ├── personas.py       # Persona CRUD
│   │   ├── conversations.py  # Chat/conversation management
│   │   └── context.py        # Context injection queries
│   └── utils/
│       ├── graph.py          # Graph traversal helpers
│       └── keys.py           # UUID generation
├── web/
│   ├── src/
│   │   ├── app/              # Next.js pages
│   │   ├── components/       # React components
│   │   ├── lib/api/          # API client with debug integration
│   │   ├── lib/stores/       # Zustand stores
│   │   └── types/            # TypeScript types
│   └── package.json
├── requirements.txt
├── run.py                    # Flask entry point
├── .env                      # Environment config (not committed)
└── .env.example
```

## Brand Guide (Anthropic-Inspired)

### Color Palette
```css
--cm-charcoal: #131314;    /* Near-black, main text */
--cm-terracotta: #d97757;  /* Warm rust accent */
--cm-cream: #faf9f0;       /* Off-white background */
--cm-amber: #e8a756;       /* Secondary accent */
--cm-sienna: #a85a3b;      /* Darker rust */
--cm-sand: #e6dfd1;        /* Subtle backgrounds */
--cm-coffee: #5c4d3c;      /* Dark brown emphasis */
--cm-ivory: #fffef8;       /* Light background */
--cm-success: #5d8a66;     /* Muted green */
--cm-warning: #d9a557;     /* Amber warning */
--cm-error: #c45c5c;       /* Muted red */
--cm-info: #6b8fa8;        /* Slate blue */
```

### Typography
- **Primary:** Inter
- **Accent:** Source Serif 4
- **Monospace:** JetBrains Mono

## Database

### Connection (Docker - AlloyDB Omni)
```bash
docker run --name jai-omni -e POSTGRES_PASSWORD=Q57SZI -p 5432:5432 -d google/alloydbomni
```

**Connection string:** `postgresql://postgres:Q57SZI@localhost:5432/collective_memory`

### Core Tables
- `entities` - Knowledge graph nodes (Person, Project, Technology, Document, Organization, Concept)
- `relationships` - Graph edges with typed relationships
- `personas` - AI model personalities
- `conversations` - Chat sessions with personas
- `chat_messages` - Individual messages
- `agents` - Registered AI agents
- `messages` - Inter-agent communication queue

## API Endpoints

- `GET/POST /api/entities` - Entity management
- `GET/POST /api/relationships` - Relationship management
- `GET/POST /api/personas` - Persona management
- `GET/POST /api/conversations` - Conversation management
- `GET/POST /api/agents` - Agent registration/status
- `GET/POST /api/messages/{channel}` - Inter-agent messaging
- `POST /api/context/query` - Context injection for prompts

**Swagger UI:** http://localhost:5000/api/docs

## Running the Project

### Start API
```bash
cd collective-memory
source venv/bin/activate
python run.py
```
API runs at http://localhost:5000/api

### Start Frontend
```bash
cd collective-memory/web
npm run dev
```
Frontend runs at http://localhost:3000

## Default Data

### Personas (seeded automatically)
1. **Claude Backend** - Backend development specialist (terracotta)
2. **Claude Frontend** - Frontend development specialist (amber)
3. **Gemini Architect** - System architect (green)

### Default User Entity
- Wayne Houlden (owner) - auto-created on first run

## Phase 1 Status: COMPLETE

- [x] Flask API with Flask-RESTX
- [x] SQLAlchemy models with auto-migrations
- [x] All CRUD routes
- [x] Next.js frontend
- [x] Chat interface with personas
- [x] Debug panel (Ctrl+Shift+D)
- [x] Dashboard, Entities, Personas, Agents, Messages pages
- [x] Graph page (placeholder)

## Phase 2 (Future)

- [ ] React Flow graph visualization
- [ ] AI model integration (Anthropic, OpenAI, Google)
- [ ] Streaming chat responses
- [ ] MCP server wrapper
- [ ] Agent checkpointing
- [ ] Context injection optimization

## Notes

- `metadata` is a reserved SQLAlchemy attribute - use `extra_data` instead
- Debug panel tracks all API requests for development
- Standard API response format: `{success, msg, data}`
